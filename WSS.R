#Western Scotian Shelf Model
#SML

#User parameters
if(Sys.info()['sysname']=="Windows"){
  data.dir <- "L:\\Rpath_code\\data"
  out.dir  <- "L:\\Rpath_code\\outputs"
  memory.limit(4000)
}
if(Sys.info()['sysname']=="Linux"){
  data.dir <- "/home/slucey/slucey/Rpath_code/data"
  out.dir  <- "/home/slucey/slucey/Rpath_code/outputs"
}

#-------------------------------------------------------------------------------
#Required packages
library(data.table); library(Rpath)

#-------------------------------------------------------------------------------
#User created functions

#-------------------------------------------------------------------------------
#Western Scotian Shelf Groups
groups <- c('Whales', 'Toothed cetaceans', 'Seals', 'Sea birds', 'Sharks', 
            'Large pelagics', 'Cod <1', 'Cod 1-3', 'Cod 4-6', 'Cod 7+', 
            'S Hake <25', 'S Hake 25-31', 'S Hake 31+', 'Halibut <46', 'Halibut 46-81',
            'Halibut 82+', 'Pollock <49', 'Pollock 49+', 'D piscivores <40', 'D piscvores 40+',
            'L benthivores <41', 'L bentivores 41+', 'Skates <49', 'Skates 49+',
            'Dogfish', 'Redfish <22', 'Redfish 22+', 'A plaice <26', 'A plaice 26+',
            'Flounders <30', 'Flounders 30+', 'Haddock <3', 'Haddock 3+', 'L sculpin <25',
            'L sculpin 25+', 'Herring <4', 'Herring 4+', 'Other pelagic', 'Mackerel',
            'Mesopelagic', 'Small-medium benthivores', 'Squids', 'Lobster', 'Large crabs',
            'Small crabs', 'Shrimps', 'Scallop', 'Bivalves', 'Other molluscs', 
            'Other arthropoda', 'Echinoderms', 'Sessile benthic groups', 'Worms', 
            'Meiofauna','Gelatinous zoop', 'Macrozoop', 'Mesozoop', 'Microzoop',
            'Microflora', 'Phytoplankton', 'Discards', 'Detritus', 'Fleet1')

#Identify type (0 = consumer, 1 = producer, 2 = detritus, 3 = fleet)
types <- c(rep(0, 59), 1, 2, 2, 3)

#Identify stanza groups
stgroups <- c(rep(NA, 6), rep('Cod', 4), rep('S hake', 3), rep('Halibut', 3), 
              rep('Pollock', 2), rep('D piscivores', 2), rep('L benthivores', 2), 
              rep('Skates', 2), NA, rep('Redfish', 2), rep('A plaice', 2), 
              rep('Flounders', 2), rep('Haddock', 2), rep('S sculpin', 2),
              rep('Herring', 2), rep(NA, 26))

#Create parameter list object
WSS.params <- create.rpath.params(groups, types, stgroups)

#Fill in model parameters
#Biomass, Production, consumption
biomass <- c(0.407075, 0.049754, 0.04383, 0.00617, 0.0260249, 0.023573, rep(NA, 3),
             0.076371, rep(NA, 2), 0.0473429, rep(NA, 2), 0.017291, NA, 0.154529,
             NA, 0.26641, NA, 0.071238, NA, 0.073658, 2.102007, NA, 1.523083, NA,
             0.101483, NA, 0.25631, NA, 0.806943, NA, 0.073649, NA, 2.25021, 0.86577,
             0.535679, 0.012515, 0.037782, 0.173893, 0.301295, 0.157303, 0.965481,
             1.302563, 0.646857, 63.37292, 2, 0.853, 12.63734, 26.02519, 7.345485,
             4.09129, 0.5204, 41.31, 23.79555, 5.800508, 3.678861, 33.664, 0.063293,
             1, NA)

pb <- c(0.071, 0.18, 0.147007, 0.25, 0.18, 0.4, 1.55, 0.39, 0.82, 0.82, 1.6, 1.3,
        1.3, 0.57, 0.27, 0.27, 0.47, 0.85, 0.44, 0.62, 0.62, 0.64, 0.2, 0.26, 0.1393199,
        0.27, 0.23, 0.44, 0.52, 0.53, 0.59, 0.66, 0.42, 0.6, 0.5, 0.64, 0.81, 0.74,
        0.583, 0.97, 1.41, 4, 0.91, 0.654, 1.31, 3, 0.342, 0.69, 0.75, 4.4, 0.33,
        0.32, 1.25, 10.8, 15.51, 3.04, NA, 82.8, 104.938, 70.639, rep(NA, 3))

qb <- c(4.94, 14.5, 7.338632, 87.6, 4.78, 4.24, rep(NA, 3), 1.326, rep(NA, 2), 3.28,
        rep(NA, 2), 1.61, NA, 2.94, NA, 2.5, NA, 1.92, NA, 1.9, 1.739802, NA, 2.41,
        NA, 2.41, NA, 3.21, NA, 2.08, NA, 3.93, NA, 2.36, 3.31, 5.08, 18.9, 4.7,
        11.33333, rep(NA, 12), 62.05, 19.5, 73, rep(NA, 6))

WSS.params$model[, Biomass := biomass]
WSS.params$model[, PB      := pb]
WSS.params$model[, QB      := qb]

#Production to Consumption
WSS.params$model[Group %in% c('Lobster', 'Large crabs', 'Small crabs', 'Shrimps', 
                              'Scallop', 'Bivalves', 'Other molluscs', 'Other arthropoda', 
                              'Echinoderms', 'Sessile benthic groups', 'Worms', 
                              'Meiofauna'),
                 ProdCons := 0.15]
WSS.params$model[Group == 'Mesozoop', ProdCons := 0.4]
WSS.params$model[Group %in% c('Microzoop', 'Microflora'), ProdCons := 0.5]

#Biomass accumulation and unassimilated production
ba <- c(0.003257, 0, 0.003702, 0, -0.001952, 0, -0.000180536, -0.0111684, -0.01359565,
        -0.00381855, rep(0, 6), -0.005120684, -0.00618116, -0.00398017, -0.0133205,
        -0.008473957, -0.0071238, rep(0, 5), -0.002998298, -0.00710381, 0, 0, 
        0.02020396, 0.05648601, -0.003061481, -0.00368245, rep(0, 7), 0.0301295,
        rep(0, 3), 0.03234285, rep(0, 13), rep(NA, 3))
WSS.params$model[, BioAcc  := ba]
WSS.params$model[, Unassim := c(rep(0.2, 55), rep(0.4, 3), 0.2, rep(0, 3), NA)]

#Detrital fate
WSS.params$model[, Detritus := c(rep(1, 60), rep(0, 3))]
WSS.params$model[, Discards := c(rep(0, 62), 1)]

#Landings/Discards
land <- c(rep(0, 4), 0.00209077, 0.005067847, 0, 0.024145, 0.08195, 0.010009, 
          0.005438, 0.023001, 0.008442, 2.9E-05, 0.00025, 0.00299, 0.004407,
          0.092313, 0, 0.058946, 0, 0.004406, 0, 0.000799, 0.01325133, 0,
          0.05914, 0, 0.005274, 0, 0.021106, 0.000433, 0.089896, 0.00084, 0.001181,
          0.230954, 0.719899, 0.019708, 0.048208, 0, 0, 0.001637, 0.203756,
          0.016668, 0, 0.000162, 0.106389, 0.010353, 0.00236, 0, 0.03026, 
          rep(0, 11), NA)
disc <- c(0, 0.002995, 0, 2.4E-05, 0.000575, 0.000469, 0.000286, rep(0, 3), 9.6E-05,
          0, 0, 3.2E-05, 0.000274, 0, 0.00029, 0, 0.002805, 0, 0.000385, 0,
          0.003928, 0.009166, 0.009694, 0.00027, 0, 9E-06, 0, 0.000372, 0, 0.000111,
          0, 0.000367, 0.000516, 0.000211, 0, 0.00056, 0.000276, 0, 0.000236,
          1.9E-05, 0.001526, 0.00725, 0.000633, 8E-06, 0, 0, 4.1E-05, 0, 0.016926,
          0.002943, rep(0, 10), NA)
WSS.params$model[, Fleet1      := land]
WSS.params$model[, Fleet1.disc := disc]

#Diet composition
DC.groups <- groups[which(!groups %in% c('Discards', 'Detritus', 'Fleet1'))]
DC.data <- as.data.table(matrix(c(
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0.006511993,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0.002663992,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0.002219998,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  1.60E-05,0.003592996,0.000956999,1.00E-06,0.000132,0.001049999,0,0.000716001,0.001558998,0.001558998,0,0,0.000295,0,0.003765996,0.003765996,6.29E-05,0,0.000405,0.000304,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.30E-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.02591697,0.04165296,0,0.02413597,0.01885398,0,0,0.003137996,0.003137996,0,0,0,0,0,0,0,0,0.01020899,0.000452,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0.08408991,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0.0042,0.07251193,0.001448999,0.000609998,0.002265998,0.001566999,0.003104,0.08762508,0.1235458,0.1235458,0.025812,0.104017,0.247549,0.04175304,0.03400496,0.03400496,0.05237934,0.1269779,0.04921795,0.07901892,0.02354798,0.008422001,0.003468997,0.000239,0.006747999,0,0.010506,0,0.021143,0,0,0,0.010337,0,0,0,0,0,0,0,0,0.002964,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.1137679,0.006529994,0,0.006987993,0.03496697,0,0,0.00045,0.00045,0,0,0,0,0.1216279,0.1216279,0,0,0,0.02597197,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.02038298,0.01144399,0,0.000668999,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0.001625999,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0.000586,0.001667998,0.06197794,7.60E-05,0,0.001342999,0,1.00E-06,0.000659999,0.000659999,0,0,0,0,0,0,0.000550719,0.000311,0,0.02802797,0,0,0,0.002293998,0,0,0,0,0,0,0,0,0.004217,0,0,0,0,0,0,0,0,0.000136,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.004976995,0.000876999,3.40E-05,0.000436,0.000345,0,0.000714001,0.001099999,0.001099999,0,0,0,0,0.01829798,0.01829798,0,0.000206,0.000388,0.003912996,0,0,0,0,0.005926999,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.000544,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.000474,0.001154999,0,0.01462898,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.01616598,0.002851997,0,0.02058598,0.001036999,0,0.001555001,0.001790998,0.001790998,0,0,0,0,0.01396198,0.01396198,0.000140479,0.000289,0.01975598,0.01728398,0.009965991,0.008671001,0.000689999,0.004071996,0.001379,0,0,0,0,0,0,0,0.000147,0.000217,0.000465,0,0,0,0,0,0,0.000215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.005863994,0.002812997,0,0.1060689,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.003382999,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0.006431994,0,0.000807999,0.002838997,0,0,3.40E-05,3.40E-05,0,0,0,0,0,0,0,0,0.004265995,0.005959994,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.000187,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.000467,0,0,0.05148594,0.01104599,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0.1381559,0,0.005025994,0.02946997,0,0.006139006,0.000443,0.000443,0,0,0,0,0,0,0.000672874,3.20E-05,0,0.002843997,0,0,0,0.1173219,0.013318,0,0,0,0,0,0,0,0.000556,0.002090998,0.004527995,0,0,0,0,0,0,0.004695,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0.06287594,0,0.01168499,0.1058389,0,0,0.09263489,0.09263489,0,0,0,0,0,0,0,0,0,0.02829297,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.001418999,1.00E-06,0,0.002332998,0.000204,0,8.00E-06,0,0,0,0,0,0,0.000723999,0.000723999,0,0,0.006327993,0.01658498,0,0,0,0.000506,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.002884003,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,2.10E-05,0,0.005476994,0,0,0,0.01793898,0.01793898,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,2.90E-05,0.02839397,0,0.05447194,0.004294996,0,0.02921703,0.00784599,0.00784599,0,0,0,0.007992008,0.00931599,0.00931599,0,0,0.01242199,0.002898997,0.000248,0,0,0,8.50E-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.004534005,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0.03502396,0,0.0952699,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.006580993,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0.012545,0.06485194,0.001711998,0.001488995,0.00949299,0.009244991,0,0.006322006,0.004070995,0.004070995,0,0.00223,0,0,0.03843996,0.03843996,0.003816348,0.02125698,0.05671994,0.03123097,0,0,0,0,0,0,0,0,0,0,0,0,0.017737,0.003529997,0.007643992,0,0,0,0,0,0,0.002768,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0.009605991,0.000817999,0,0.01761098,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2941507,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0.001303999,0.000729,0,0.000163,0,0,0.00038,0.00038,0,0,0,0,0.008629991,0.008629991,0,0,0.03402996,0.01133799,0,0,0.003015997,0.000183,0,0,0,0,0,0,0,0,0,0.001053999,0.002273998,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0.01100999,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0.073926,0.1365819,0.005578995,0.3092771,0.06827693,0.1093259,0,0.06407906,0.2363977,0.2363977,0,0,0.447494,0.03217503,0.4673175,0.4673175,0.001415988,0.09100391,0.1855898,0.2135368,0,0,0.01811798,0.02999297,0.258508,0,0,0,0,0,0,0,0.011786,0,0,0,0,0,0,0,0,0.012258,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0.089594,0.1968788,0.4870085,0,0.3303816,0.4789326,0,0.04180104,0.1004399,0.1004399,0,0,0.07026301,0,0,0,0.00380515,0.08936992,0,0.07483192,0,0,0,0,0.05229799,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0.0194,0.007396993,0.05680194,0.07663676,0.04387695,0.1276559,0,0.01247601,0.09192089,0.09192089,0.018319,0.030496,0.06424201,0.008163008,0.002218998,0.002218998,0.07084115,0.008247993,0.000745999,0.04285895,0.01080399,0.029568,0.02243098,0.04578396,0.006191999,0.007741,0.029417,0.004934,0.005391,0.01061201,0.001190999,0.01262801,0.003427,0.01653299,0.03526796,0,0,0,0,0,0,0.004734,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0.010398,0.04417396,0.02815897,0.04363187,0.02364997,0.02666597,0,0.05530305,0,0,0,0,0,0,0.006816993,0.006816993,0,0.02717697,0,0.01119399,0,0,0,0,0.028541,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.003069,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0.002380993,0,0,0,0.000101,0,0,0,0,0,0,0,0,0,0.000162,0,0.000435,0.02631398,0,0.001562999,0,7.00E-06,0,2.80E-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0.000580999,0.002858991,0,0.000926999,0,0.000621001,0.000208,0.000208,0,0,0,0.000394,0,0,0,0,0.00955499,0.000603999,0.01757298,0.046767,0.000828999,0.003071997,0.007229999,0,0,0,0,0,0,0,7.00E-06,0.000880999,0.001896998,0,0,0,0,0,0.000585001,0,0.000838,0.001769,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0.011769,0.2679567,0.002056998,0.03595289,0.01354798,0.01555398,0,0.004383004,0.007024992,0.007024992,0.02913,0,0.047062,0.006183006,0.00990799,0.00990799,0.00214994,0.01683598,0.0881829,0.002041998,0.002899997,0.000367,0.003267997,0.009869991,0.04755399,0,0,0,0,0,0,0.000450001,0.01407,0,0,0,0,0,0,0,0,0.037929,0,0.008357,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,2.10E-05,0,0,7.20E-05,0,3.40E-05,0.000397,0.000397,0,0,0,0,0,0,0,0,0.001110999,0.000153,0.01110299,0.008531001,0,0.001687998,0.002615,0,0,0,0,0,0,0.002170002,0.002447,0.002627997,0.002561997,0,0,0,0,0,0,0,0.003342,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,9.30E-05,1.00E-06,0,0.01709602,0.02262897,0.02262897,0,0,0,0.000644001,0.009989989,0.009989989,0,0,0.003362997,0.003651996,0.002453998,0.000228,0.002008998,0.01136499,0.00136,0,0,0,0,0,0.000161,0.000424,0.001319,0.005867994,0.005734994,0,0,0,0,0,0.02003702,0,0.005944,0.001101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0.006644,0.1857692,0.1731288,0.1731288,0.00085,0,0,0.2296602,0.1033519,0.1033519,0.003205569,0.00011,0.007745991,0.01392199,0.1821278,0.264914,0.0996079,0.1766018,0.011512,0,0,0,0.016303,0,0.01654298,0.05755806,0.092844,0.3476897,0.3389587,0,0,0,0,0,0.003498004,0.014737,0.110362,0.02056,0,0,0,0,0.00686,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0.000710999,0,0,0.003309997,0.102318,0.06881607,0.005501993,0.005501993,0.122673,0.074385,0.006444001,0.2295252,0.002236998,0.002236998,0.2326323,0.08527492,0.01903198,0.005200994,0.09076391,0.02218,0.05435595,0.0996329,0.034228,0.058683,0.207457,0.136381,0.007813,0.000672001,0.001377999,0.03517104,0.022234,0.1342779,0.1279749,0.0675,0.0675,0.03362296,0.025021,0,0.1077271,0.010014,0.000164,0.004209,0,0,0,0,0.020851,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0.000256,8.00E-06,8.00E-06,0,0,0,0,0,0,0,0,4.00E-06,0.000104,0.02106898,0.196245,0,0,0.002766,0,0,0.031627,0.043077,0,0.000722999,0.000919001,0.00095,0.00034,0.000331,0,0,0,0,0,0,0,0,0.01727,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0.002550002,0.009014989,0.009014989,0,0.000301,7.00E-06,0,0.000132,0.000132,0,0.000239,0.000817999,0.000570999,0.03552497,0.065873,0.001373999,7.50E-05,4.00E-06,0,0,0.274346,0.054735,0.08711208,0.04039396,0.1019161,0.038664,0.00016,0.000157,0,0,0,0,0,0.03415903,0,0.264599,0.491575,0.05595795,0,0,0,0.332281,0,0.016104,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0.005864006,0.002303997,0.002303997,0,0,0,0,0.000122,0.000122,0.007092156,5.70E-05,0.001659998,1.00E-06,0.000854999,0.05410101,0.000146,0.004686995,0.000447,0,0,0.027576,0.010781,0.009591009,0.01150099,0.008003009,0.018815,0.004689995,0.004567995,0,0,0,0,0,0.02048402,0,0.038274,0.051839,0.05595795,0,0,0,0.027689,0,0.008389,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0.232479,0.001346001,7.20E-05,7.20E-05,0.026944,0.006414,0,0,0,0,0.01495797,0,0.001424999,7.20E-05,0.03453997,0.0251,0.04237796,0.003397997,2.60E-05,0.020983,0.003376,0.03555501,0.005059,0.1171171,0.08391692,0.05415006,0.016159,0.01903898,0.01856198,0.023112,0.023112,0.06520893,0.031488,0,0.1160341,0,0.003578,0.011448,0.01618998,0.004533,0,0,0.03083,0.0075,0.002502,0,0.02,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0.016056,0.01940102,0.01034699,0.01034699,0,0,0,0,0,0,0,0.000121,0,1.00E-06,0.04334996,0.09409402,0,0.001664998,2.10E-05,0,0,0.127529,0.266447,0.02438802,0.02435898,0.2073532,0.37349,0.01032099,0.01005499,0,0,0,0,0,0.02519003,0,0.267847,0.085048,0,0,0,0,0.027689,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0.01216899,0,0.02467202,0.02574297,0.02574297,0,0,0,0,0.004950995,0.004950995,0.00018527,1.50E-05,0.001779998,0,0.003615997,0.000569,0.000813999,0.000228,0.000559,0,0,0,0.000183,0.07454707,0.1506929,0.001112001,0.037861,0.003652997,0.003560996,0.003573,0.003573,0,0.002512,0,0.005539006,0,0.074532,0.000287,0.05595795,0,0,0,0,0,0.008389,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0.004012,0.005415005,0.001838998,0.001838998,0.001834,1.00E-06,0,0.01681102,0.000195,0.000195,0.000988443,0,0.001282999,0,0.02201298,0.035901,0.2152108,0.1659708,0.004025,0,0,0.119117,0.057396,0.4499434,0.5097205,0.1840372,0.109511,0.03638997,0.03545596,0,0,0.000879999,0.008373,0,0.2088902,0.013273,0.076097,0.30299,0.1119149,0.015272,0,0,0,0,0.008389,0,0.070001,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.013252,0,0.2238298,0,0,0,0.2769,0.025449,0,0,0.070001,0.05,0,0,0,0,0,0,
  0,0,0,0,0,5.90E-05,0.008033001,0.003404003,0,0,0,0,0,0,0,0,0.002145868,0.000556,0.00017,0,0.000176,0.010475,0,0.004026996,0.273597,0.025964,0.001675,0,0.003102,0,0.001789998,0.007693008,0.00371,0,0,0,0,0.001311999,0.001382,0,0,0.001571,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0.726929,0,0,0.315373,0,0,0.6071391,0.3532963,0.05709393,0.05709393,0.753288,0.739995,0.113508,0.4266994,0.05225594,0.05225594,0.4432664,0.5240815,0.4703945,0.07535792,0.4567336,0.124971,0.3669736,0.3125047,0.23311,0.871389,0.733914,0.163721,0.504933,0.03966104,0.01397099,0.1767202,0.166314,0.4008156,0.3904336,0.877033,0.877033,0.4149986,0.717669,0,0.4400224,0.890893,0,0,0,0.123605,0,0,0,0,0,0.039305,0,0,0.161448,0.055941,0,0,0,0,
  0.050637,0,0,0,0,0,0.020215,0.001019001,0.000338,0.000338,0.02115,0.027914,0.003136,0,0,0,0.05789468,0.006939994,0.004794995,0.000444,0.004320996,0.003023,0.1637468,0.004821995,2.40E-05,0.00875,0.013627,0.07921401,0.003637,0.1186091,0.03188697,0.1496951,0.053398,0.009821991,0.00956999,0.028782,0.028782,0.4740715,0.213555,1,0.01041601,0,0,0,0,0.244326,0,0,0,0,0,0.035968,0,0,0.696038,0.47728,0.058572,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.026305,0,0,0.095929,0.11221,0.161911,0.099731,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.02719697,0.008578,0.04999995,0.095,0,0,0,0.070066,0,0,0.005032,0.015172,0.076645,0.202492,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.002626997,0,0,0,0,0,0,0,0.069225,0.4222216,0.882656,0,0,0,0.61037,0,0,0.041553,0.127274,0.702872,0.209335,0,0,
  0,0.005316995,0,0.000552998,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.002142,0.003547,0.005332995,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.087293,0,0.4476616,0.534461,0.5277785,0.022344,0.2769,0.967051,0.956227,0.217986,0.839998,0.95,0,0.212123,0,0.488442,1,0,
  0,0,0,0.2077324,0,0.000843999,0,0,0,0,0,0.014247,0,0,0.0917349,0.0917349,0.1017964,0.000735999,0.008602991,0.000165,0,0,0,0,0.004536,0.00649,0,0,0,0.06774706,0.1117719,0,0,0,0,0,0,0.007278992,0,0,0,0,0.051736,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),
  63, 60, byrow = T))

#Merge DC matrix with diet parameter object
WSS.params$diet <- cbind(WSS.params$diet[, Group], DC.data)
#Fix column names
setnames(WSS.params$diet, 1, 'Group')
setnames(WSS.params$diet, paste0('V', 1:60), DC.groups)

#Set multistanza parameters
#Group parameters
WSS.params$stanzas$stgroups[, VBGF_Ksp := c(0.14, 0.46, 0.14, 0.16, 0.075, 0.14, 
                                            0.13, 0.06, 0.12, 0.21, 0.27, 0.12, 
                                            0.28)]
WSS.params$stanzas$stgroups[, Wmat     := c(0.04, 0.22, 0.24, 0.13, 0.02, 0.15,
                                            0.4, 0.06, 0.06, 0.17, 0.16, 0.15,
                                            0.33)]

#Individual stanza parameters
WSS.params$stanzas$stindiv[, First   := c(0, 12, 48, 84, 0, 25, 48, 0, 36, 72,
                                          0, 48, 0, 47, 0, 66, 0, 109, 0, 108, 
                                          0, 57, 0, 46, 0, 36, 0, 65, 0, 48)]
WSS.params$stanzas$stindiv[, Last    := c(11, 47, 83, 400, 24, 47, 400, 35, 71,
                                          400, 47, 400, 46, 400, 65, 400, 108, 
                                          400, 107, 400, 56, 400, 45, 400, 35, 
                                          400, 64, 400, 47, 400)]
WSS.params$stanzas$stindiv[, Z       := c(1.55, 0.39, 0.82, 0.82, 1.6, 1.3, 1.3,
                                          0.57, 0.27, 0.27, 0.47, 0.85, 0.44, 0.62,
                                          0.62, 0.64, 0.2, 0.26, 0.27, 0.23, 0.44, 
                                          0.52, 0.53, 0.59, 0.66, 0.42, 0.6, 0.5,
                                          0.64, 0.81)]
WSS.params$stanzas$stindiv[, Leading := c(F, F, F, T, F, F, T, F, F, T, rep(c(F, T), 10))]

#Need to run this function to calculate all the stanza biomass/consumptions
#The calculated biomasses are different than EwE because of the BA terms...will investigate further
WSS.params <- rpath.stanzas(WSS.params)

#Ecopath
#Note - slighly out of balance due to the stanza biomass differences
WSS <- rpath(WSS.params, 'Western Scotian Shelf')



                
